"use strict";(()=>{var e={};e.id=25,e.ids=[25],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},1615:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>h});var a={};t.r(a),t.d(a,{GET:()=>d,POST:()=>p});var o=t(5419),s=t(9108),i=t(9678),n=t(8070),c=t(7699),u=t(2455);async function p(e){try{let r=(0,c.createRouteHandlerClient)({cookies:u.cookies}),{data:{session:t}}=await r.auth.getSession();if(!t)return n.Z.json({error:"N\xe3o autorizado. Fa\xe7a login para continuar."},{status:401});let{data:a,error:o}=await r.from("brands").select("*").eq("id",t.user.id).single();if(o||!a)return n.Z.json({error:"Apenas marcas podem criar campanhas."},{status:403});let s=await e.json();for(let e of["title","description","start_date","end_date"])if(!s[e])return n.Z.json({error:`Campo obrigat\xf3rio ausente: ${e}`},{status:400});s.brand_id=t.user.id;let{data:i,error:p}=await r.from("campaigns").insert([s]).select().single();if(p)return console.error("Erro ao criar campanha:",p),n.Z.json({error:"Erro ao criar campanha. Por favor, tente novamente."},{status:500});return await r.from("notifications").insert([{user_id:t.user.id,title:"Campanha criada com sucesso",content:`Sua campanha "${i.title}" foi criada com sucesso.`,type:"campaign_created",is_read:!1,metadata:{campaign_id:i.id}}]),n.Z.json({campaign:i},{status:201})}catch(e){return console.error("Erro interno:",e),n.Z.json({error:"Erro interno do servidor"},{status:500})}}async function d(e){try{let r=(0,c.createRouteHandlerClient)({cookies:u.cookies}),{data:{session:t}}=await r.auth.getSession();if(!t)return n.Z.json({error:"N\xe3o autorizado. Fa\xe7a login para continuar."},{status:401});let a=e.nextUrl.searchParams,o=a.get("status"),s=parseInt(a.get("limit")||"10"),i=parseInt(a.get("page")||"1"),p=(i-1)*s,{data:d}=await r.from("brands").select("id").eq("id",t.user.id).single(),l=r.from("campaigns").select(`
      *,
      brands:brand_id (
        name,
        logo_url
      ),
      participations:participations (
        id,
        status,
        creator_id
      )
    `);l=d?l.eq("brand_id",t.user.id):l.eq("status","active"),o&&(l=l.eq("status",o)),l=(l=l.range(p,p+s-1)).order("created_at",{ascending:!1});let{data:m,error:g,count:x}=await l;if(g)return console.error("Erro ao buscar campanhas:",g),n.Z.json({error:"Erro ao buscar campanhas. Por favor, tente novamente."},{status:500});return n.Z.json({campaigns:m,pagination:{page:i,limit:s,total:x||0,pages:x?Math.ceil(x/s):0}})}catch(e){return console.error("Erro interno:",e),n.Z.json({error:"Erro interno do servidor"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/campaigns/route",pathname:"/api/campaigns",filename:"route",bundlePath:"app/api/campaigns/route"},resolvedPagePath:"/Users/luizgustavovincenzi/ai-projects/CriaCore/criacore/src/app/api/campaigns/route.ts",nextConfigOutput:"export",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:x,headerHooks:f,staticGenerationBailout:h}=l,q="/api/campaigns/route";function v(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[225,890,280],()=>t(1615));module.exports=a})();